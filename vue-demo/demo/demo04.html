<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>计算属性</title>
</head>
<body>
<div id="app">
    <p>Original message: {{ msg }}</p>
    <p>Computed reversed message: {{ reversedMsg }}</p>
    <p>fullName: {{ fullName }}</p>
    <p>firstName: {{ firstName }}</p>
    <p>lastName: {{ lastName }}</p>
    <p><input type="text" v-model="question"></p>
    <p>今年的母亲节是{{ answer }}</p>
</div>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/lodash/lodash.min.js"></script>
<script>
    var question = '今年的母亲节是什么时候？';
    var vm = new Vue({
        el: '#app',
        data: {
            msg: 'reverse',
            firstName: 'Cristiano',
            lastName: 'Ronaldo',
            question: '',
            answer: '请输入`' + question +'`'
        },
        created: function () {
            setTimeout(function () {
                vm.fullName = 'Leo Messi';
            }, 2000);
        },
        // 计算属性基于它们的依赖进行缓存。
        // 除非相关依赖发生改变，否则多次访问计算属性，
        // 返回的是之前的计算结果，而不必再次执行函数
        computed: {
            reversedMsg: function () {
                // `this`point to the vm instance
                return this.msg.split('').reverse().join('');
            },
            fullName: {
                get: function () {
                    return this.firstName + ' ' + this.lastName;
                },
                set: function (newValue) {
                    var names = newValue.split(' ');
                    this.firstName = names[0];
                    this.lastName = names[names.length - 1];
                }
            }
        },
        watch: {
            question: function (newQuestion) {
                this.answer = '等待你完成输入';
                this.getAnswer();
            }
        },
        methods: {
            getAnswer: _.debounce(
                    function () {
                        if (this.question.indexOf(question) === -1) {
                            vm.answer = '请重新输入`' + question + '`';
                        }
                        vm.date = '我思考一下...';
                        axios.get('./demo04')
                                .then(function (response) {
                                    vm.answer = response.data;
                                })
                                .catch(function (error) {
                                    vm.answer = '服务器出错了！';
                                })
                    }, 500)
        }
    })
</script>
</body>
</html>